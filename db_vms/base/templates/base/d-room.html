{% extends "main.html" %}

{% load static %}



{% block content %}
<link href="{% static 'assets/lib/emojionearea/emojionearea.min.css'%}" rel="stylesheet">
<script src="{% static 'assets/lib/emojionearea/emojionearea.min.js'%}"></script>
<!-- <h5>Single Discussion Room</h5> -->

<!-- <div class="card mb-3" style="background-color: #197056;">
    <div class="bg-holder d-none d-lg-block bg-card"
        style="background-image:url({% static 'assets/img/icons/spot-illustrations/corner-4.png'%});">
    </div>

    <div class="card-body position-relative">
        <div class="row">
            <div class="col-lg-8">
                <h3 style="color: white !important;margin-bottom: 0 !important;">{{room.title}}</h3>
                <div class="dropdown">

                </div>
            </div>
        </div>
    </div>
</div> -->

<!-- <div class="card mb-3">
  <div class="bg-holder d-none d-lg-block bg-card"
    style="background-image:url({% static 'assets/img/icons/spot-illustrations/corner-4.png'%});">
  </div>

  <div class="card-body position-relative">
    <div class="row">
      <div class="col-lg-12">
        <h3>{{room.title}}</h3>
        <p class="mb-1 mt-2">{{room.description}}</p>
        <p class="mb-1 mt-2">Created by: {{room.host}}</p>
        <p class="mb-1 mt-2">Created on: {{room.created_at}}</p>
        <div class="row">
          <div class="col-lg-6"></div>
          <div class="col-lg-3">
            <p class="mb-1 mt-2">Created by: {{room.host}}</p>
          </div>
          <div class="col-lg-3">
            <p class="mb-1 mt-2">Created {{room.created_at|timesince}} ago</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> -->

<div class="card mb-3 rounded-3" style=" justify-content: center; background-color: #197056;">

  <div class="row flex-between-end mx-2 py-3">
    <div class="col-10">
      <h2 class="mb-0 pb-0" style="color: white">{{room.title}}: {{room.topic}}</h2>
      <p class="mb-3 mt-3" style="color: white; text-align: justify;">{{room.description}}</p>
      <!-- list down the room members -->
      {% if room.members %}
      <div class="row">
        <div class="col-12">
          <h5 class="mb-2 pb-0" style="color: white">Members</h5>
          <div class="row">
            {% for member in members %}
            <div class="col-2">
              <div class="card mb-3 rounded-3" style=" justify-content: center; background-color: #197056; border-color: white;">
                <div class="position-relative">
                  <div class="row">
                    <div class="col-lg-12">
                      <p class="mb-1 mt-2 text-center text-uppercase" style="color: white">{{member}}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        </div>
      {% endif %}
    </div>
    <div class="col-2">
      {% if room.host == request.user or request.user.is_superuser %}
      <div class="col-auto">
        <form method="POST" action="{% url 'delete_room' room.id %}">
          {% csrf_token %}
          <button value="Delete" class=""  style="padding: 5px 18px;
          border-radius: 5px;
          border-color: #197056;
          float: right;
          color: #197056;
      " type="button" data-bs-toggle="modal" data-bs-target="#scrollinglongcontent"><span
              class="far fa-trash-alt"></span></button>
        
      </div>
      <div class="modal fade" id="scrollinglongcontent" data-keyboard="false" tabindex="-1" aria-labelledby="scrollinglongcontentLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="scrollinglongcontentLabel">Confirmation</h5>
              <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body modal-dialog modal-dialog-scrollable mt-0">
              <p>
                Are you sure you want to delete this room?</p>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Close</button>
              <button class="btn btn-primary" type="submit">Yess</button>
            </form>
            </div>
          </div>
        </div>
      </div>
      {% endif %}
    </div>
    <span style="clear: both">
      <h5 style="float: left; color: white; margin-bottom: 0px;">
        Created by: @{{room.host}}
      </h5>
      <h5 style="float: right; color: white; margin-bottom: 0px;">
        Created {{room.created_at|timesince}} ago
      </h5>
    </span>
    
  </div>
</div>





<!-- check if current user is project manager -->

{% if room.host == request.user or request.user.is_superuser or request.user in members %}
<!-- End Write Message -->
<div class="card mb-3">
  <div class="card-header bg-light overflow-hidden">
    <div class="d-flex align-items-center">
      <div class="flex-1">
        <h5 class="mb-0 fs-0">Write a message <span class="far fa-comment-dots"></span> </h5>
      </div>
    </div>
  </div>
  <div class="card-body">
    <form method="POST">
      {% csrf_token %}
      <div class="row g-3">
        <div class="col-10">
          <textarea class="shadow-none form-control rounded-1 resize-none px-card border-200"
            placeholder="Enter message here.." rows="3" name="body" id="message-body"></textarea>

        </div>
        <div class="col-2" style="align-self: end;">
          <div class="d-grid gap-2 col-12 mx-auto">
            <div class="position-relative">
              <div class="btn btn-hbl" id="emoji-button" data-emoji-button="data-emoji-button"><span
                  class="far fa-laugh-beam"></span></div>
            </div>
            <button class="btn btn-hbl btn-sm px-5 py-2" type="submit">Send</button>
          </div>

        </div>
      </div>
    </form>
  </div>
</div>
{% endif %}
<!-- Showing PRev Messages -->
{% for message in messages %}
<div class="card mb-3">
  <div class="card-header bg-light">
    <div class="row justify-content-between">
      <div class="col">
        <div class="d-flex">
          <div class="avatar avatar-2xl">
            <img class="rounded-circle" src="{% static 'assets/img/team/avatar.png' %}" alt="">

          </div>
          <div class="flex-1 align-self-center ms-2">
            <p class="mb-1 lh-1"><span class="fw-semi-bold txt-hbl">@{{message.user}}</span></p>
            <p class="mb-0 fs--1">{{message.timestamp|timesince}} ago</p>
          </div>
        </div>
      </div>
      {% if message.user == request.user or room.host == request.user or request.user.is_superuser %}
      <div class="col-auto">
        <form method="POST" action="{% url 'delete_message' message.id %}">
          {% csrf_token %}
          <button value="Delete" class="btn btn-sm btn-outline-hbl" type="submit"><span
              class="far fa-trash-alt"></span></button>
        </form>
      </div>
      {% endif %}
    </div>
  </div>
  <div class="card-body">
    <p>{{message.message}}</p>
  </div>

</div>


{% endfor %}
<!-- End Prev MEssages -->

<script>
  const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
  const button = document.querySelector('#emoji-button');
  const picker = new EmojiButton(
    {
      theme: currentTheme == 'dark' ? 'dark' : 'light',
      showPreview: false,
      autoHide: false
    }
  );
  button.addEventListener('click', () => {
    picker.togglePicker(button);

  });
  picker.on('emoji', emoji => {
    document.querySelector('#message-body').value += emoji;
  });


  

</script>

{% endblock content %}